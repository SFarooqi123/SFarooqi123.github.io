<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project 1 – Prokudin-Gorskii Colorization</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&display=swap" rel="stylesheet">

  <style>
    :root{
      /* sibling palette to your Project 0 */
      --bg: #0b1113;
      --panel: #0f1719;
      --panel-2: #101c1f;
      --text: #e7f0f2;
      --muted: #9cb3b9;
      --accent: #18b0b0;
      --accent-2: #ffc857;
      --ring: #1e2a2d;
      --code: #0f2430;
      --radius: 18px;
      --maxw: 1000px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: 'Outfit', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% -220px, #0e1517 10%, var(--bg) 60%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      line-height: 1.6;
    }

    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: 42px 20px 80px; }

    header{ text-align:center; margin-bottom: 22px; }
    .eyebrow{
      display:inline-block; padding: 4px 10px; border-radius: 999px;
      background: rgba(24,176,176,.14); color: #b6f3f3; border: 1px solid rgba(24,176,176,.35);
      font-size: 12px; letter-spacing: .35px; text-transform: uppercase; margin-bottom: 10px;
    }
    h1{
      margin: 0 0 6px; font-size: clamp(26px, 4.6vw, 40px); font-weight: 700; letter-spacing: .2px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .subtitle{ margin: 0; color: var(--muted); font-size: 14.5px; }

    /* Sections as cards */
    .card{
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid var(--ring); border-radius: var(--radius);
      padding: 18px 18px 22px; margin: 18px 0;
      box-shadow: 0 14px 32px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
    }
    .card h2{ font-size: 20px; font-weight: 700; margin: 0 0 12px; color: #d9fdff; }
    .card h3{ font-size: 16px; margin: 10px 0 8px; color: #d9fdff; }
    .card p, .card ul{ color: var(--muted); font-size: 15px; margin: 8px 0; }

    /* Figures & galleries */
    .figgrid{ display:grid; gap:16px; }
    @media (min-width: 760px){
      .figgrid.cols-2{ grid-template-columns: 1fr 1fr; }
      .figgrid.cols-3{ grid-template-columns: 1fr 1fr 1fr; }
    }
    figure{ margin:0; background:#0e1517; border:1px solid #1b2629; border-radius:14px; overflow:hidden; }
    figure img{ display:block; width:100%; height:auto; }
    figcaption{
      padding: 10px 12px 12px;
      color:#b7c7cb; font-size: 13px; line-height:1.4;
      font-family: "Source Serif 4", ui-serif, Georgia, serif;
      border-top: 1px solid #172124; background: linear-gradient(180deg, #0f1618, #0b1214);
    }
    figcaption .name{ color:#e9fafc; font-weight:700; }
    figcaption .off{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; color:#c6f3ff; font-weight:600; }

    /* Offsets table */
    .table-wrap{ overflow-x:auto; margin-top:10px; }
    table{
      width:100%; border-collapse: collapse; font-size: 14px; color: var(--text);
      background: #0e1517; border: 1px solid #1b2629; border-radius: 12px; overflow:hidden;
    }
    thead th{
      text-align:left; background:#0f181a; color:#d9fdff; border-bottom:1px solid #1b2629; padding:10px 12px;
    }
    tbody td{ padding:10px 12px; border-top:1px solid #142024; color:#cfe1e4; }
    tbody tr:hover{ background:#0f181a; }

    code, pre{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      background: var(--code); color: #c6f3ff; border: 1px solid #18303d; border-radius: 10px; padding: 4px 7px;
    }
    pre{ padding:10px 12px; overflow:auto; }

    .footer{
      margin-top: 26px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
      color: var(--muted); font-size: 13px;
    }
    .footer a{ color: var(--accent-2); text-decoration:none; }
    .footer a:hover{ text-decoration:underline; }
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <span class="eyebrow">CS180 • Computer Vision & Computational Photography</span>
      <h1>Project 1: Prokudin-Gorskii Colorization</h1>
      <p class="subtitle">Registering historical B/G/R plates to reconstruct color images.</p>
    </header>

    <!-- EXPLANATION FIRST (like the example site) -->
    <section class="card" id="overview">
      <h2>Overview</h2>
      <p>
        Sergey Prokudin-Gorskii photographed scenes through blue, green, and red filters on glass plates. This project
        reconstructs color images by aligning Green and Red to the Blue plate, then stacking them into an RGB image.
        The focus is on the alignment algorithm; images shown below are compressed (JPG/PNG/GIF) per assignment rules
        — no large <code>.tif</code> files are uploaded.
      </p>
    </section>

    <section class="card" id="approach">
      <h2>Approach</h2>
      <h3>Small Images (Exhaustive Search)</h3>
      <ul>
        <li>Search window: integer shifts <code>(dy, dx) ∈ [-15, 15]</code>.</li>
        <li>Pre-processing: per-channel mean-centering; crop ~10% from each edge to avoid black plate borders.</li>
        <li>Transform: apply shifts with <code>np.roll</code>, but score only the internal (non-wrapped) region.</li>
        <li>Metric: <strong>NCC</strong> (Normalized Cross Correlation) to reduce sensitivity to contrast differences.</li>
      </ul>

      <h3>Large Images (Image Pyramid)</h3>
      <ul>
        <li>Downsample by ½ until the max dimension &lt; ≈500 px; run the same NCC search at the coarsest level.</li>
        <li>Propagate the displacement up the pyramid (×2 each level) and refine in a narrow window (e.g., <code>[-5,5]</code>).</li>
        <li>Apply a mild Gaussian blur before downsampling to preserve structure.</li>
      </ul>

      <h3>Problems & How I Addressed Them</h3>
      <ul>
        <li><strong>Edge/Border bias</strong> → use interior crop before scoring.</li>
        <li><strong>Inverted/channel-dependent contrast (e.g., <em>emir</em>)</strong> → align <em>edge maps</em> (H/V 3×3 filters, magnitude sum, optional threshold) instead of raw intensities.</li>
        <li><strong>Low texture / ambiguous NCC peaks</strong> → larger coarse window; pyramid levels; edge-based NCC.</li>
      </ul>

      <pre><code># Offset convention used on this page:
# Offsets are reported as (dy, dx) for G←B and R←B.
# +dy = shift down, +dx = shift right.</code></pre>
    </section>

    <!-- RESULTS SECTIONS (galleries first, then a consolidated offsets table) -->
    <section class="card" id="results-jpg">
      <h2>Results: Provided JPGs (Exhaustive)</h2>
      <div class="figgrid cols-2">
        <!-- Replace src and offsets as needed -->
        <figure>
          <img src="./media/cathedral_color.jpg" alt="cathedral colorized" />
          <figcaption>
            <span class="name">cathedral.jpg</span> — G <span class="off">(2, 5)</span> | R <span class="off">(3, 12)</span>
          </figcaption>
        </figure>
        <figure>
          <img src="./media/monastery_color.jpg" alt="monastery colorized" />
          <figcaption>
            <span class="name">monastery.jpg</span> — G <span class="off">(2, -3)</span> | R <span class="off">(2, 3)</span>
          </figcaption>
        </figure>
        <figure>
          <img src="./media/tobolsk_color.jpg" alt="tobolsk colorized" />
          <figcaption>
            <span class="name">tobolsk.jpg</span> — G <span class="off">(3, 3)</span> | R <span class="off">(3, 6)</span>
          </figcaption>
        </figure>
      </div>
    </section>

    <section class="card" id="results-tif">
      <h2>Results: Provided TIFs (Compressed Outputs)</h2>
      <p>Per the instructions, this page only hosts <em>compressed</em> results derived from the TIF sources.</p>
      <div class="figgrid cols-2">
        <figure>
          <img src="./media/church_color.jpg" alt="church colorized" />
          <figcaption><span class="name">church.tif</span> — G <span class="off">(4, 25)</span> | R <span class="off">(-4, 58)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/harvesters_color.jpg" alt="harvesters colorized" />
          <figcaption><span class="name">harvesters.tif</span> — G <span class="off">(17, 60)</span> | R <span class="off">(13, 124)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/icon_color.jpg" alt="icon colorized" />
          <figcaption><span class="name">icon.tif</span> — G <span class="off">(17, 41)</span> | R <span class="off">(23, 89)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/italil_color.jpg" alt="italil colorized" />
          <figcaption><span class="name">italil.tif</span> — G <span class="off">(21, 38)</span> | R <span class="off">(35, 77)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/lastochikino_color.jpg" alt="lastochikino colorized" />
          <figcaption><span class="name">lastochikino.tif</span> — G <span class="off">(-2, -3)</span> | R <span class="off">(-9, 75)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/lugano_color.jpg" alt="lugano colorized" />
          <figcaption><span class="name">lugano.tif</span> — G <span class="off">(-16, 41)</span> | R <span class="off">(-29, 93)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/melons_color.jpg" alt="melons colorized" />
          <figcaption><span class="name">melons.tif</span> — G <span class="off">(11, 82)</span> | R <span class="off">(13, 178)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/self_portrait_color.jpg" alt="self portrait colorized" />
          <figcaption><span class="name">self_portrait.tif</span> — G <span class="off">(29, 79)</span> | R <span class="off">(37, 176)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/siren_color.jpg" alt="siren colorized" />
          <figcaption><span class="name">siren.tif</span> — G <span class="off">(-6, 49)</span> | R <span class="off">(-25, 96)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/three_generations_color.jpg" alt="three generations colorized" />
          <figcaption><span class="name">three_generations.tif</span> — G <span class="off">(14, 53)</span> | R <span class="off">(11, 112)</span></figcaption>
        </figure>
      </div>
    </section>

    <!-- Consolidated offsets table (after galleries, like the example page) -->
    <section class="card" id="offsets-table">
      <h2>Offsets (dy, dx) relative to Blue</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Image</th>
              <th>G offset</th>
              <th>R offset</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <!-- JPGs -->
            <tr><td>cathedral.jpg</td><td>(2, 5)</td><td>(3, 12)</td><td>Exhaustive, 10% crop.</td></tr>
            <tr><td>monastery.jpg</td><td>(2, -3)</td><td>(2, 3)</td><td>Halo reduced by border trim.</td></tr>
            <tr><td>tobolsk.jpg</td><td>(3, 3)</td><td>(3, 6)</td><td>Stable NCC peak.</td></tr>
            <!-- TIFs (compressed) -->
            <tr><td>church.tif</td><td>(4, 25)</td><td>(-4, 58)</td><td>Pyramid; narrow refine window.</td></tr>
            <tr><td>harvesters.tif</td><td>(17, 60)</td><td>(13, 124)</td><td>Strong texture.</td></tr>
            <tr><td>icon.tif</td><td>(17, 41)</td><td>(23, 89)</td><td>Border crop before scoring.</td></tr>
            <tr><td>italil.tif</td><td>(21, 38)</td><td>(35, 77)</td><td>Typo as in dataset.</td></tr>
            <tr><td>lastochikino.tif</td><td>(-2, -3)</td><td>(-9, 75)</td><td>Asymmetric borders.</td></tr>
            <tr><td>lugano.tif</td><td>(-16, 41)</td><td>(-29, 93)</td><td>Coarse-to-fine helped.</td></tr>
            <tr><td>melons.tif</td><td>(11, 82)</td><td>(13, 178)</td><td>Gray-world WB improved cast.</td></tr>
            <tr><td>self_portrait.tif</td><td>(29, 79)</td><td>(37, 176)</td><td>Faces align well with NCC.</td></tr>
            <tr><td>siren.tif</td><td>(-6, 49)</td><td>(-25, 96)</td><td>Water motion minimal.</td></tr>
            <tr><td>three_generations.tif</td><td>(14, 53)</td><td>(11, 112)</td><td>Fine detail stabilizes NCC.</td></tr>
          </tbody>
        </table>
      </div>
      <p style="margin-top:10px">Only compressed images are displayed; original <code>.tif</code> files are not uploaded.</p>
    </section>

    <!-- Failures explanation -->
    <section class="card" id="failures">
      <h2>Failure Cases & Explanations</h2>
      <p>
        If an image failed to align, provide a short reason and what you tried. Example:
        <em>emir.tif</em> shows inverted/intense color differences across channels, making raw-intensity NCC unreliable.
        I switched to edge-based alignment (H/V 3×3 filters, magnitude, threshold ≈0.2) and ran the pyramid search on the edge maps.
      </p>
      <div class="figgrid cols-2">
        <figure>
          <img src="./media/emir_color.jpg" alt="emir final colorized" />
          <figcaption><span class="name">emir.tif</span> — G <span class="off">(24, 49)</span> | R <span class="off">(40, 107)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/emir_edges.jpg" alt="emir edge map used for alignment" />
          <figcaption><span class="name">Edge map</span> used for alignment (H/V 3×3 + threshold).</figcaption>
        </figure>
      </div>
    </section>

    <!-- Your own chosen images -->
    <section class="card" id="own">
      <h2>Additional Images (My Picks from Prokudin-Gorskii)</h2>
      <div class="figgrid cols-2">
        <figure>
          <img src="./media/mills_color.jpg" alt="mills colorized" />
          <figcaption><span class="name">mills.tif</span> — G <span class="off">(14, 56)</span> | R <span class="off">(23, 125)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/dome_color.jpg" alt="dome colorized" />
          <figcaption><span class="name">dome.tif</span> — G <span class="off">(-4, 52)</span> | R <span class="off">(-6, 125)</span></figcaption>
        </figure>
        <figure>
          <img src="./media/boat_color.jpg" alt="boat colorized" />
          <figcaption><span class="name">boat.tif</span> — G <span class="off">(39, 42)</span> | R <span class="off">(81, 134)</span></figcaption>
        </figure>
      </div>
    </section>

    <!-- Bells & whistles with before/after -->
    <section class="card" id="bells">
      <h2>Bells & Whistles</h2>
      <ul>
        <li><strong>Edge-guided alignment</strong> for low-texture/inverted-contrast scenes.</li>
        <li><strong>Auto-contrast</strong> via percentile clipping (≈1–2% per channel).</li>
        <li><strong>Gray-world white balance</strong> to reduce global casts.</li>
      </ul>
      <div class="figgrid cols-3">
        <figure><img src="./media/sample_before.jpg" alt="before"><figcaption><span class="name">Before</span> — unaligned stack.</figcaption></figure>
        <figure><img src="./media/sample_aligned.jpg" alt="aligned"><figcaption><span class="name">Aligned</span> — after NCC/pyramid.</figcaption></figure>
        <figure><img src="./media/sample_post.jpg" alt="post"><figcaption><span class="name">Post</span> — +contrast & WB.</figcaption></figure>
      </div>
    </section>

    <!-- Submission -->
    <section class="card" id="submission">
      <h2>Submission</h2>
      <p>
        This webpage includes: (1) overview and approach, (2) results on provided images with offsets, (3) additional
        images of my choosing, (4) brief explanations for failures, and (5) bells & whistles with before/after. All
        images are compressed (no <code>.tif</code> uploads). I will submit this page’s URL to the class gallery via the Google Form.
      </p>
    </section>

    <div class="footer">
      <div>© Samar Farooqi • Project 1</div>
      <div><a href="../index.html">← Back to Portfolio</a></div>
    </div>
  </main>
</body>
</html>
